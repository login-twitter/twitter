define(["jquery","backbone","BaseView","formValidator","inputValidator","lap","history","app","parseParams","scTempTracking","validations"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";var c=n.extend({el:e("#onboardingContent"),events:{"blur div.textInput input":"trimInput"},trimInput:function(t){var n=e(t.target);n.val(e.trim(n.val()))},afterRender:function(){this.context=this.model.attributes;var t=e("body").attr("class")||"";t=t.match(/view\-[a-zA-Z]*/g),t&&t.length===1&&e("body").removeClass(t[0]),this.context.viewName&&e("body").addClass("view-"+this.context.viewName),this.validations=l,this.validationContent=window.PAYPAL.merchantboarding.validationContent,this.requiredOnly={},this.requiredOnly[this.validationContent.required]=this.validations.required,this.requiredCheckOnly={},this.requiredCheckOnly[this.validationContent.required]=this.validations.requiredRadio,window.opener&&window.opener.blur(),window.focus(),e(".textInput").lap(),e(".textArea").filter(".lap").lap(),e("input, select").on("change keydown",function(t){t.keyCode!==e.ui.keyCode.ENTER&&t.keyCode!==e.ui.keyCode.TAB&&t.keyCode!==e.ui.keyCode.ESCAPE&&t.keyCode!==e.ui.keyCode.CONTROL&&t.keyCode!==e.ui.keyCode.ALT&&t.keyCode!==e.ui.keyCode.UP&&t.keyCode!==e.ui.keyCode.DOWN&&t.keyCode!==e.ui.keyCode.LEFT&&t.keyCode!==e.ui.keyCode.RIGHT&&t.keyCode!==e.ui.keyCode.WINDOWS&&t.keyCode!==e.ui.keyCode.CAPS_LOCK&&t.keyCode!==e.ui.keyCode.SHIFT&&e(this).removeClass("serverError")}),this._handleForms(),setTimeout(function(){window.scrollTo(0,0)},1),e(document.activeElement).is("input")&&document.activeElement.blur();var n=document.querySelectorAll('input[type="checkbox"].ios-switch');for(var r=0,i;i=n[r++];){var s=document.createElement("div");s.className="switch",i.parentNode.insertBefore(s,i.nextSibling)}},globalErrorLinkHandler:function(){e("#paypalDeveloperLink").click(function(){if(e("div#lastview").length>0){var t=e("#onboardingContent form").attr("action");e("div#lastview form").attr("action",t),e("div#lastview form").submit()}})},_handleForms:function(){var t=this.$el.find("form");t.attr("novalidate","novalidate"),t.formValidator(),this.lastClickedSubmitInput=null,e("input[type=submit], button[type=submit]",this.$el).click(e.proxy(function(t){this.lastClickedSubmitInput=e(t.target)},this)),t.on("submit",e.proxy(function(t){var n=e(t.target),r=n.data("pp-formValidator"),i=!1;if(n.hasClass("defaultSubmit"))return;t.preventDefault(),e("#pageLevelMessage").fadeOut(250),r.update(),e.event.trigger({type:"appViewHandleFormsStarting",message:"appViewHandleFormsStarting...pre validation phase",status:!0}),this.lastClickedSubmitInput=this.lastClickedSubmitInput||e("input[type=submit], button[type=submit]",n),i=this.lastClickedSubmitInput.data("validate")===!1,i||r.validate(t)?(e.event.trigger({type:"appViewHandleFormsValidated",message:"form is valid...submitting data via ajax",event:t,status:!0}),n.trigger("post"),this._ajaxFormPost(n)):e.event.trigger({type:"appViewHandleFormsValidated",message:"form is NOT valid...NOT submitting data via ajax",status:!1})},this))},addContextualHelp:function(t){var n=e("#"+t),r=e("<div/>",{"class":"informationContainer contextualHelpContainer hide"}),i=e("body"),s=e(this.el);i.append(r),r.attr("role","tooltip"),r.attr("aria-hidden","true"),r.attr("id",n.attr("aria-describedby")),i.on("focus mouseover touchstart",function(t){var n=e(t.target);r.addClass("hide"),r.empty(),r.attr("aria-hidden","true")}),n.on("blur mouseout",function(e){r.addClass("hide"),r.empty(),r.attr("aria-hidden","true")}),n.on("focus mouseover",function(t){var i=n.offset(),o={top:Math.floor(i.top+parseInt(n.css("height"),10)/2),left:Math.floor(i.left+parseInt(n.css("width"),10)/2)},u=o.left+parseInt(r.css("width"),10),a={top:o.top+10},f=Math.floor(s.offset().left),l=f+parseInt(s.css("width"),10);t.stopPropagation(),r.hasClass("hide")&&(r.append(e("<p>",{html:window.unescape(n.data("contextualHelp"))})),u>l?(r.removeClass("caret"),r.addClass("rightCaret"),a.left=o.left-parseInt(r.css("width"),10)+3,a.left<f&&(r.removeClass("rightCaret"),a.left=f+10)):(r.removeClass("rightCaret"),r.addClass("caret"),a.left=o.left-18),r.css({position:"absolute",top:a.top,left:a.left}),r.attr("aria-hidden","false"),r.removeClass("hide"))}),r.on("mouseover",function(e){e.stopPropagation()})},addContextualHelpOnce:function(t){var n=e(t),r=n.find(".contextualHelp"),i=e("body"),s=e(this.el);r.each(function(t){var n=e("<div/>",{"class":"informationContainer contextualHelpContainer hide"}),o=e(r[t]);i.append(n),n.attr("role","tooltip"),n.attr("aria-hidden","true"),n.attr("id",o.attr("aria-describedby")),i.on("focus mouseover touchstart",function(t){var r=e(t.target);n.addClass("hide"),n.attr("aria-hidden","true")}),o.on("blur mouseout",function(e){n.addClass("hide"),n.attr("aria-hidden","true")}),o.on("focus mouseover",function(t){var r=o.offset(),i={top:Math.floor(r.top+parseInt(o.css("height"),10)/2),left:Math.floor(r.left+parseInt(o.css("width"),10)/2)},u=i.left+parseInt(n.css("width"),10),a={top:i.top+10},f=Math.floor(s.offset().left),l=f+parseInt(s.css("width"),10),c="";t.stopPropagation(),n.hasClass("hide")&&(n.html()===""&&(o.data("contextualHelp")?(c=o.data("contextualHelp"),n.append(e("<p>",{html:c}))):(c=e("#"+o.data("contextualHelpId")).html(),n.append(c))),u>l?(n.removeClass("caret"),n.addClass("rightCaret"),a.left=i.left-parseInt(n.css("width"),10)+3,a.left<f&&(n.removeClass("rightCaret"),a.left=f+10)):(n.removeClass("rightCaret"),n.addClass("caret"),a.left=i.left-18),n.css({position:"absolute",top:a.top,left:a.left}),n.attr("aria-hidden","false"),n.removeClass("hide"))}),n.on("mouseover",function(e){e.stopPropagation()})})},formProcessingIndicator:function(t,n){var r=e("input[type=submit], button[type=submit]",t);n==="start"?(r.addClass("processing"),r.addClass("disabled"),r.attr("disabled","disabled")):(r.removeClass("processing"),r.removeClass("disabled"),r.removeAttr("disabled"))},_ajaxFormPost:function(t){this.formProcessingIndicator(t,"start");var n=this.lastClickedSubmitInput.attr("name"),r=this.lastClickedSubmitInput.val(),i=t.serialize()+"&"+n+"="+r;this.context._csrf&&(i=i+"&_csrf="+this.context._csrf),e.ajax({type:"post",url:t.attr("action"),data:i,success:e.proxy(function(e){u.handleResponse(e,this,t)},this),error:e.proxy(function(){this.formProcessingIndicator(t,"stop")},this)})},formSuccess:function(e,t){}});return c})